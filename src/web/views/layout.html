<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Email Helper</title>
    <link rel="icon" type="image/png" href="/favicon.png" />
  <style>
    body { font-family: ui-sans-serif, system-ui; margin: 24px; background: #fafafa; }
    header { display:flex; gap:12px; align-items:center; margin-bottom: 16px; }
    .btn { padding:8px 12px; border:1px solid #ddd; background:#fff; border-radius:8px; cursor:pointer; text-decoration:none; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(420px,1fr)); gap:12px; }
    .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:14px; box-shadow:0 1px 2px rgba(0,0,0,0.03); }
    .brief-container { max-width:720px; margin-bottom:20px; }
    .brief-card { background:#fffef5; border-color:#f6e3c5; box-shadow:0 2px 6px rgba(161, 98, 7, 0.08); }
    .brief-label { text-transform:uppercase; font-size:11px; letter-spacing:0.08em; color:#a16207; margin-bottom:4px; display:inline-block; }
    .brief-title { font-size:20px; font-weight:700; margin-bottom:8px; color:#713f12; }
    .brief-highlights { margin:8px 0 0 18px; padding:0; color:#4b5563; list-style:disc; }
    .brief-highlights li { margin-bottom:6px; }
    .brief-highlights a.brief-link {
      color:inherit;
      text-decoration:none;
      border-bottom:1px dashed transparent;
      cursor:pointer;
      transition:color 0.15s ease, border-color 0.15s ease;
    }
    .brief-highlights a.brief-link:hover,
    .brief-highlights a.brief-link:focus-visible {
      color:#1d4ed8;
      border-bottom-color:rgba(59,130,246,0.45);
      outline:none;
    }
    .brief-link-icon {
      font-size:0.8em;
      margin-left:4px;
      opacity:0.45;
      transition:opacity 0.15s ease;
    }
    .brief-highlights a.brief-link:hover .brief-link-icon,
    .brief-highlights a.brief-link:focus-visible .brief-link-icon {
      opacity:0.85;
    }
    .superhead { display:flex; align-items:center; gap:6px; color:#555; font-size:12px; letter-spacing:0.02em; margin-bottom:4px; }
    .emoji { line-height:1; }
    .headline { font-weight:700; font-size:16px; margin-bottom:6px; }
    .subject { font-weight:600; margin-bottom:6px; }
    .meta { color:#666; font-size:12px; margin:2px 0; }
    .label { color:#444; font-weight:600; }
    .next { color:#333; font-weight:500; }
    .secretary-container { max-width:720px; margin-bottom:20px; }
    .secretary-card { background:#eef2ff; border-color:#c7d2fe; box-shadow:0 2px 6px rgba(79, 70, 229, 0.08); }
    .secretary-label { text-transform:uppercase; font-size:11px; letter-spacing:0.08em; color:#4338ca; margin-bottom:6px; display:inline-block; }
    .secretary-message { margin:0 0 12px 0; font-size:15px; color:#312e81; }
    .secretary-email { border-radius:10px; background:#fff; padding:12px; border:1px solid #d4dcff; margin-bottom:12px; }
    .secretary-email h4 { margin:0 0 6px 0; font-size:15px; color:#111827; }
    .secretary-email p { margin:4px 0; color:#374151; }
    .secretary-email .label { color:#111827; font-weight:600; }
    .secretary-link { display:inline-block; margin-top:8px; font-size:13px; color:#4338ca; text-decoration:none; }
    .secretary-link:hover { text-decoration:underline; }
    .secretary-btn { padding:8px 14px; border:none; border-radius:20px; background:#4338ca; color:#fff; font-weight:600; cursor:pointer; transition:opacity 0.15s ease, transform 0.15s ease; }
    .secretary-btn[disabled] { cursor:not-allowed; opacity:0.6; }
    .secretary-btn:not([disabled]):active { transform:translateY(1px); }

    /* Loading overlay */
    .loading-backdrop {
      position: fixed; inset: 0;
      background: rgba(255,255,255,0.75);
      display: flex; align-items: center; justify-content: center;
      z-index: 9999;
    }
    .hidden { display: none; }
    .spinner {
      width: 48px; height: 48px;
      border: 3px solid #e5e7eb; /* gray-200 */
      border-top-color: #3b82f6;  /* blue-500 */
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg) } }
    .loading-text { margin-top: 12px; color:#444; font-size:14px; text-align:center; }
    .loading-wrap { display:flex; flex-direction:column; align-items:center; }
  </style>
</head>
<body>
  <header>
    <a class="btn" href="/dashboard">Dashboard</a>
    <form id="ingest-form" action="/ingest" method="post"><button class="btn" type="submit">Ingest Inbox (30d)</button></form>
  </header>

  <!--CONTENT-->

  <!-- Loading overlay -->
  <div id="loading" class="loading-backdrop hidden" aria-live="polite" aria-busy="true">
    <div class="loading-wrap">
      <div class="spinner" role="status" aria-label="Loading"></div>
      <div class="loading-text">Fetching latest inboxâ€¦</div>
    </div>
  </div>

<script>
  // Show spinner on manual ingest submit.
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('ingest-form');
    const overlay = document.getElementById('loading');

    if (form) {
      form.addEventListener('submit', function () {
        if (overlay) overlay.classList.remove('hidden');
      });
    }

    // Auto-ingest after first render if server says we're empty (first-time auth)
    if (window.AUTO_INGEST && form) {
      // Give the DOM a tick to paint the existing UI, then trigger ingest.
      requestAnimationFrame(() => {
        if (overlay) overlay.classList.remove('hidden');
        form.submit(); // normal POST; server redirects back to /dashboard when done
      });
    }
  });
</script>

</body>
</html>
