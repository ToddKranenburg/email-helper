<div class="triage-app">
  <header class="triage-header">
    <div class="triage-title">
      <p class="triage-label">Primary Inbox</p>
      <div class="triage-heading">
        <h1 class="triage-count" id="triage-count">0 emails</h1>
        <button class="load-more-btn hidden" id="load-more-head" type="button">Load more</button>
      </div>
    </div>
    <div class="triage-controls">
      <button id="map-toggle" class="map-toggle" type="button" aria-expanded="false" aria-controls="inbox-drawer">Inbox map</button>
      <form id="ingest-form" action="/ingest" method="post">
        <button class="sync-btn" type="submit">Sync Gmail</button>
      </form>
    </div>
  </header>
  <div class="triage-progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
    <div class="triage-progress-fill" id="triage-progress"></div>
  </div>
  <p id="ingest-error" class="ingest-error hidden" role="alert"></p>

  <section class="triage-shell" id="triage-shell">
    <article class="email-panel" id="email-panel" aria-live="polite">
      <div class="email-card" id="email-card">
        <p class="email-position hidden" id="email-position">0 of 0</p>
        <div class="email-meta">
          <div class="avatar" id="email-avatar" aria-hidden="true">–</div>
          <div class="email-meta-details">
            <div class="email-meta-top">
              <p class="sender" id="email-sender">Waiting on Gmail…</p>
              <span class="email-dot" aria-hidden="true">•</span>
              <p class="email-subject" id="email-subject">No email selected</p>
            </div>
            <p class="timestamp" id="email-received">Select ingest to begin.</p>
          </div>
          <a id="email-cta" class="cta-link hidden" target="_blank" rel="noreferrer">Open in Gmail ↗</a>
        </div>
        <div class="preview-drawer lifted">
          <div id="email-preview" class="email-preview hidden" aria-live="polite"></div>
          <button id="preview-toggle" class="preview-toggle" type="button" disabled>See email body</button>
        </div>
      </div>
      <div class="empty-card hidden" id="email-empty">
        <p>Nothing left in Needs Review. You’re caught up.</p>
        <button class="load-more-btn hidden" id="load-more-empty" type="button">Load more</button>
      </div>

      <section class="assistant-stack" id="assistant-panel">
        <div class="assistant-chat" id="assistant-chat">
          <div class="chat-stream" id="assistant-chat-log" aria-live="polite">
            <div class="chat-placeholder-card">I’ll drop the gist and nudge you forward.</div>
          </div>
        </div>
        <form id="assistant-form" class="assistant-input">
          <label class="sr-only" for="assistant-input-field">Ask the assistant anything</label>
          <textarea id="assistant-input-field" placeholder="Type or just tap Done / Archive / Skip…" rows="1"></textarea>
          <button type="submit">Send</button>
        </form>
        <div class="triage-actions">
          <button class="triage-btn done" id="action-done" type="button">✔️ Done</button>
          <button class="triage-btn archive" id="action-archive" type="button">Archive in Gmail</button>
          <button class="triage-btn skip" id="action-skip" type="button">➡️ Skip</button>
        </div>
        <div class="assistant-meta">
          <span id="assistant-hint">Ask up to 20 questions per email.</span>
          <span class="chat-error hidden" id="assistant-error"></span>
        </div>
      </section>
    </article>
  </section>
</div>

<div class="drawer-backdrop hidden" id="inbox-drawer" aria-hidden="true">
  <div class="drawer-panel" role="dialog" aria-modal="true" aria-labelledby="drawer-title">
    <div class="drawer-handle"></div>
    <div class="drawer-header">
      <div>
        <p class="drawer-label">Global Inbox Map</p>
        <h2 class="drawer-title" id="drawer-title">Needs Review vs Done</h2>
      </div>
      <button id="drawer-close" class="drawer-close" type="button" aria-label="Close inbox map">✕</button>
    </div>
    <div class="drawer-section">
      <div class="drawer-section-head">
        <h3>Needs Review</h3>
        <span id="needs-count">0</span>
      </div>
      <ul id="needs-list" class="drawer-list" aria-live="polite">
        <li class="drawer-empty">Nothing queued up.</li>
      </ul>
    </div>
    <div class="drawer-section">
      <details id="done-details">
        <summary>
          <div class="drawer-section-head">
            <h3>Done</h3>
            <span id="done-count">0</span>
          </div>
        </summary>
        <ul id="done-list" class="drawer-list">
          <li class="drawer-empty">No finished emails yet.</li>
        </ul>
      </details>
    </div>
  </div>
</div>
